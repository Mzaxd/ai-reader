# P2-3: å…³ç³»ç­›é€‰è®¾è®¡

## é—®é¢˜èƒŒæ™¯

åŸå‹å®¡æŸ¥æŠ¥å‘Šä¸­æŒ‡å‡ºï¼š
- **æ— å…³ç³»ç­›é€‰è®¾è®¡ - å¦‚ä½•æŒ‰ç±»å‹/å¼ºåº¦ç­›é€‰ï¼Ÿ**
- **ç¼ºå°‘"ç»„ç»‡/æ´¾ç³»/é˜µè¥"å…³ç³»ç±»å‹**

è¿™æ˜¯ä¸€ä¸ª **Minor** çº§åˆ«çš„é—®é¢˜ï¼Œä½†å½±å“ç”¨æˆ·åˆ†æå¤æ‚å…³ç³»ç½‘ç»œã€‚

---

## è®¾è®¡æ–¹æ¡ˆ

### 1. å…³ç³»ç±»å‹æ‰©å±•

#### 1.1 æ‰©å±•åçš„å…³ç³»ç±»å‹

```typescript
/**
 * å…³ç³»ç±»å‹æšä¸¾ï¼ˆæ‰©å±•ç‰ˆï¼‰
 */
enum RelationType {
  // åŸæœ‰ç±»å‹
  FAMILY = 'family',           // å®¶åº­å…³ç³»
  FRIEND = 'friend',           // å‹è°Š
  ENEMY = 'enemy',             // æ•Œå¯¹
  COLLEAGUE = 'colleague',     // åŒäº‹
  
  // æ–°å¢ç±»å‹
  ORGANIZATION = 'organization', // ç»„ç»‡å…³ç³»
  FACTION = 'faction',         // æ´¾ç³»å…³ç³»
  ALLIANCE = 'alliance',       // åŒç›Ÿ
  SUBORDINATE = 'subordinate', // ä¸Šä¸‹çº§
  MENTOR = 'mentor',           // å¸ˆå¾’
  RIVAL = 'rival',             // ç«äº‰å¯¹æ‰‹
  OTHER = 'other',             // å…¶ä»–
}

/**
 * å…³ç³»å¼ºåº¦
 */
enum RelationStrength {
  STRONG = 'strong',    // å¼ºå…³ç³»
  MEDIUM = 'medium',    // ä¸­ç­‰å…³ç³»
  WEAK = 'weak',        // å¼±å…³ç³»
}
```

### 2. ç­›é€‰é¢æ¿ UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” å…³ç³»ç­›é€‰                                         [é‡ç½®]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ“Œ å¿«æ·ç­›é€‰                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [å®¶åº­å…³ç³»] [æ•Œå¯¹å…³ç³»] [ç»„ç»‡å…³ç³»] [å…¨éƒ¨æ˜¾ç¤º]                   â”‚
â”‚                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                             â”‚
â”‚  ğŸ·ï¸ å…³ç³»ç±»å‹                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â˜‘ å®¶åº­å…³ç³» (äº²å±)                                          â”‚
â”‚  â˜‘ å‹è°Š                                     â”‚
â”‚  â˜‘ æ•Œå¯¹                                       â”‚
â”‚  â˜‘ åŒäº‹ (colleague)                                         â”‚
â”‚  â˜‘ ç»„ç»‡å…³ç³» (organization)                                  â”‚
â”‚  â˜‘ æ´¾ç³»å…³ç³» (faction)                                       â”‚
â”‚  â˜‘ åŒç›Ÿ (alliance)                                          â”‚
â”‚  â˜ ä¸Šä¸‹çº§ (subordinate)                                     â”‚
â”‚  â˜ å¸ˆå¾’ (mentor)                                            â”‚
â”‚  â˜ ç«äº‰å¯¹æ‰‹ (rival)                                         â”‚
â”‚  â˜ å…¶ä»– (other)                                             â”‚
â”‚                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                             â”‚
â”‚  ğŸ’ª å…³ç³»å¼ºåº¦                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â˜‘ å¼ºå…³ç³»                                                   â”‚
â”‚  â˜‘ ä¸­ç­‰å…³ç³»                                                 â”‚
â”‚  â˜ å¼±å…³ç³»                                                   â”‚
â”‚                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                             â”‚
â”‚  ğŸ• æ—¶é—´èŒƒå›´                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â—‹ å…¨éƒ¨æ—¶é—´                                                 â”‚
â”‚  â—‹ ç‰¹å®šæ—¶æœŸ: [1960] â”€â”€â”€ [2000]                              â”‚
â”‚                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                             â”‚
â”‚  ğŸ‘¤ äººç‰©å±æ€§                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  æ€§åˆ«: â—‹ å…¨éƒ¨  â—‹ ç”·  â—‹ å¥³  â—‹ å…¶ä»–                           â”‚
â”‚  é˜µè¥: [å…¨éƒ¨ â–¼]                                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. å·²é€‰æ¡ä»¶å±•ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å½“å‰ç­›é€‰: [å®¶åº­å…³ç³» Ã—] [æ•Œå¯¹ Ã—] [å¼ºå…³ç³» Ã—]    [æ¸…é™¤å…¨éƒ¨]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ“Š ç­›é€‰ç»“æœ: 23 æ¡å…³ç³» (å…± 156 æ¡)                          â”‚
â”‚                                                             â”‚
â”‚  å…³ç³»å›¾æ˜¾ç¤º...                                               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. æ•°æ®æ¨¡å‹

```typescript
/**
 * å…³ç³»ç­›é€‰æ¡ä»¶
 */
interface RelationshipFilter {
  /** å…³ç³»ç±»å‹åˆ—è¡¨ */
  relationTypes: RelationType[];
  
  /** å…³ç³»å¼ºåº¦åˆ—è¡¨ */
  strengths: RelationStrength[];
  
  /** æ—¶é—´èŒƒå›´ */
  timeRange?: {
    start?: string;
    end?: string;
  };
  
  /** äººç‰©å±æ€§ç­›é€‰ */
  characterAttributes?: {
    gender?: 'male' | 'female' | 'other';
    faction?: string;
  };
}

/**
 * ç­›é€‰ç»“æœ
 */
interface FilterResult {
  /** ç­›é€‰åçš„å…³ç³»åˆ—è¡¨ */
  relationships: Relationship[];
  
  /** åŒ¹é…æ•°é‡ */
  matchCount: number;
  
  /** æ€»æ•°é‡ */
  totalCount: number;
  
  /** ç­›é€‰è€—æ—¶ */
  executionTime: number;
}

/**
 * å¿«æ·ç­›é€‰é¢„è®¾
 */
interface QuickFilterPreset {
  id: string;
  name: string;
  icon: string;
  filter: RelationshipFilter;
}

/**
 * é¢„è®¾å¿«æ·ç­›é€‰
 */
const QUICK_FILTERS: QuickFilterPreset[] = [
  {
    id: 'family',
    name: 'å®¶åº­å…³ç³»',
    icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦',
    filter: { relationTypes: [RelationType.FAMILY] },
  },
  {
    id: 'conflict',
    name: 'æ•Œå¯¹å…³ç³»',
    icon: 'âš”ï¸',
    filter: { relationTypes: [RelationType.ENEMY, RelationType.RIVAL] },
  },
  {
    id: 'organization',
    name: 'ç»„ç»‡å…³ç³»',
    icon: 'ğŸ›ï¸',
    filter: { relationTypes: [RelationType.ORGANIZATION, RelationType.FACTION] },
  },
];
```

### 5. ç­›é€‰ç»“æœå±•ç¤º

#### 5.1 å…³ç³»å›¾å±•ç¤º

- **ç¬¦åˆæ¡ä»¶çš„**: æ­£å¸¸æ˜¾ç¤ºï¼Œé«˜äº®è¿æ¥çº¿
- **ä¸ç¬¦åˆæ¡ä»¶çš„**: ç°è‰²æ·¡åŒ–æ˜¾ç¤ºæˆ–éšè—

```typescript
/**
 * åº”ç”¨ç­›é€‰åˆ°å…³ç³»å›¾
 */
const applyFilterToGraph = (
  relationships: Relationship[],
  filter: RelationshipFilter
) => {
  return relationships.map(rel => {
    const matches = matchesFilter(rel, filter);
    return {
      ...rel,
      visible: matches,
      opacity: matches ? 1 : 0.2,  // ä¸ç¬¦åˆçš„æ·¡åŒ–
    };
  });
};
```

### 6. äº¤äº’æµç¨‹

```mermaid
flowchart TD
    A[æ‰“å¼€ç­›é€‰é¢æ¿] --> B[æ˜¾ç¤ºå½“å‰ç­›é€‰æ¡ä»¶]
    B --> C{ç”¨æˆ·æ“ä½œ}
    
    C -->|ç‚¹å‡»å¿«æ·ç­›é€‰| D[åº”ç”¨é¢„è®¾æ¡ä»¶]
    C -->|æ‰‹åŠ¨é€‰æ‹©ç±»å‹| E[åˆ‡æ¢ç±»å‹é€‰ä¸­çŠ¶æ€]
    C -->|è°ƒæ•´å¼ºåº¦| F[é€‰æ‹©å¼ºåº¦èŒƒå›´]
    C -->|è®¾ç½®æ—¶é—´| G[é…ç½®æ—¶é—´èŒƒå›´]
    
    D --> H[æ›´æ–°ç­›é€‰ç»“æœ]
    E --> H
    F --> H
    G --> H
    
    H --> I[æ›´æ–°å…³ç³»å›¾æ˜¾ç¤º]
    I --> J[æ›´æ–°ç­›é€‰è®¡æ•°]
    
    C -->|ç‚¹å‡»é‡ç½®| K[æ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶]
    K --> L[æ˜¾ç¤ºå…¨éƒ¨å…³ç³»]
```

### 7. å…³ç³»ç±»å‹æ‰©å±•æœºåˆ¶

```typescript
/**
 * è‡ªå®šä¹‰å…³ç³»ç±»å‹
 */
interface CustomRelationType {
  id: string;
  name: string;
  description?: string;
  color: string;
  icon?: string;
}

/**
 * å…³ç³»ç±»å‹æ³¨å†Œè¡¨
 */
class RelationTypeRegistry {
  private types: Map<string, RelationTypeConfig>;
  
  register(type: CustomRelationType): void {
    this.types.set(type.id, type);
  }
  
  getAll(): RelationTypeConfig[] {
    return Array.from(this.types.values());
  }
  
  getById(id: string): RelationTypeConfig | undefined {
    return this.types.get(id);
  }
}
```

---

## éªŒæ”¶æ ‡å‡†

- [ ] ç­›é€‰é¢æ¿æ­£å¸¸æ˜¾ç¤º
- [ ] å¯æŒ‰å…³ç³»ç±»å‹ç­›é€‰
- [ ] å¯æŒ‰å…³ç³»å¼ºåº¦ç­›é€‰
- [ ] å¯æŒ‰æ—¶é—´èŒƒå›´ç­›é€‰
- [ ] å¿«æ·ç­›é€‰æ­£å¸¸å·¥ä½œ
- [ ] ç­›é€‰ç»“æœæ­£ç¡®æ˜¾ç¤º
- [ ] å…³ç³»å›¾æ­£ç¡®é«˜äº®/æ·¡åŒ–
- [ ] å¯é‡ç½®ç­›é€‰æ¡ä»¶
