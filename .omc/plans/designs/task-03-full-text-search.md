# å…¨æ–‡æœç´¢å…¥å£è®¾è®¡

**è®¾è®¡è€…**: designer-3
**ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-02-19

---

## ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æœç´¢å…¥å£è®¾è®¡](#æœç´¢å…¥å£è®¾è®¡)
3. [æœç´¢é¢æ¿è®¾è®¡](#æœç´¢é¢æ¿è®¾è®¡)
4. [æœç´¢ç»“æœå±•ç¤º](#æœç´¢ç»“æœå±•ç¤º)
5. [é«˜çº§æœç´¢åŠŸèƒ½](#é«˜çº§æœç´¢åŠŸèƒ½)
6. [äº¤äº’æµç¨‹](#äº¤äº’æµç¨‹)
7. [æŠ€æœ¯å®ç°](#æŠ€æœ¯å®ç°)
8. [TypeScript ç±»å‹å®šä¹‰](#typescript-ç±»å‹å®šä¹‰)

---

## æ¦‚è¿°

### é—®é¢˜èƒŒæ™¯

å½“å‰åŸå‹é˜…è¯»å™¨ç¼ºå°‘å…¨æ–‡æœç´¢åŠŸèƒ½ï¼Œç”¨æˆ·æ— æ³•ï¼š
- å¿«é€ŸæŸ¥æ‰¾ç‰¹å®šå…³é”®è¯
- è·¨ç« èŠ‚æœç´¢å†…å®¹
- å®šä½æ‰€æœ‰åŒ¹é…é¡¹

### è®¾è®¡ç›®æ ‡

1. **æ˜“å‘ç°æ€§**ï¼šå¤šç§å…¥å£æ–¹å¼ï¼Œç”¨æˆ·å®¹æ˜“æ‰¾åˆ°
2. **é«˜æ•ˆæ€§**ï¼šå¿«é€Ÿæœç´¢å“åº”ï¼Œå³æ—¶ç»“æœå±•ç¤º
3. **æ˜“ç”¨æ€§**ï¼šç®€æ´çš„äº¤äº’æµç¨‹ï¼Œæ¸…æ™°çš„ç»“æœå±•ç¤º
4. **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒé«˜çº§æœç´¢å’Œè‡ªå®šä¹‰é…ç½®

---

## æœç´¢å…¥å£è®¾è®¡

### å…¥å£ä½ç½®

#### 1. é˜…è¯»å™¨å·¥å…·æ 

**ä½ç½®**ï¼šé˜…è¯»å™¨é¡¶éƒ¨å·¥å…·æ å³ä¾§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜…è¯»å™¨                                              [ğŸ” æœç´¢] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**UI ç»„ä»¶**ï¼š
- å›¾æ ‡æŒ‰é’®ï¼šæœç´¢å›¾æ ‡ï¼ˆğŸ”ï¼‰
- å¿«æ·é”®æç¤ºï¼šHover æ—¶æ˜¾ç¤º "Ctrl+F"
- çŠ¶æ€æŒ‡ç¤ºï¼šæœç´¢æ¿€æ´»æ—¶æ˜¾ç¤ºé«˜äº®è¾¹æ¡†

#### 2. å¿«æ·é”®è§¦å‘

| å¿«æ·é”® | åŠŸèƒ½ | é€‚ç”¨å¹³å° |
|--------|------|----------|
| `Ctrl+F` | æ‰“å¼€æœç´¢é¢æ¿ | Windows/Linux |
| `Cmd+F` | æ‰“å¼€æœç´¢é¢æ¿ | macOS |
| `Ctrl+G` / `F3` | ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹ | å…¨å¹³å° |
| `Ctrl+Shift+G` / `Shift+F3` | ä¸Šä¸€ä¸ªåŒ¹é…é¡¹ | å…¨å¹³å° |
| `Escape` | å…³é—­æœç´¢é¢æ¿ | å…¨å¹³å° |

#### 3. å…¨å±€æœç´¢å…¥å£

**ä½ç½®**ï¼šé¡¶éƒ¨å¯¼èˆªæ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å†Œ] AI Reader    ä¹¦åº“   é˜…è¯»å™¨   äººç‰©   æ—¶é—´çº¿   äº‹ä»¶   [ğŸ”]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½**ï¼š
- ç‚¹å‡»æ‰“å¼€å…¨å±€æœç´¢å¯¹è¯æ¡†
- æ”¯æŒè·¨ä¹¦ç±æœç´¢
- æ”¯æŒæœç´¢å†å²è®°å½•

### æœç´¢çŠ¶æ€è®¾è®¡

| çŠ¶æ€ | è§†è§‰è¡¨ç° |
|------|----------|
| æœªæ¿€æ´» | ç°è‰²å›¾æ ‡æŒ‰é’® |
| æ¿€æ´» | è“è‰²é«˜äº®è¾¹æ¡† |
| æœ‰åŒ¹é… | å›¾æ ‡ä¸Šæ˜¾ç¤ºåŒ¹é…æ•°é‡å¾½ç«  |
| æ— åŒ¹é… | ç°è‰²å›¾æ ‡ + "0" å¾½ç«  |

---

## æœç´¢é¢æ¿è®¾è®¡

### é¢æ¿å¸ƒå±€

æœç´¢é¢æ¿é‡‡ç”¨**åº•éƒ¨æŠ½å±‰**æˆ–**ä¾§è¾¹æ **å½¢å¼ï¼Œæ¨èä½¿ç”¨å³ä¾§æ»‘å‡ºé¢æ¿ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜…è¯»å™¨å†…å®¹                                              [Ã—]  â”‚ â† å…³é—­æŒ‰é’®
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ” æœç´¢è¾“å…¥æ¡†                        [é€‰é¡¹â–¼] [Ã—]  â”‚  â”‚  â”‚ â† æœç´¢åŒº
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ ç­›é€‰ï¼š[å…¨éƒ¨ç« èŠ‚â–¼] [åŒ¹é…æ¨¡å¼â–¼]              [æ›´å¤šâ–¼]â”‚  â”‚  â”‚ â† ç­›é€‰åŒº
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ æ‰¾åˆ° 12 ä¸ªåŒ¹é…é¡¹                                  â”‚  â”‚  â”‚ â† ç»Ÿè®¡ä¿¡æ¯
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ â—€ ç¬¬ 1 / 12 ä¸ª                                    â”‚  â”‚  â”‚ â† å¯¼èˆªæ§åˆ¶
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ ç¬¬17ç«                                             â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ ...æŠŠåœ°çƒé€’ç»™<mark>æœªçŸ¥</mark>æ–‡æ˜...              â”‚  â”‚  â”‚ â† ç»“æœåˆ—è¡¨
â”‚  â”‚ â”‚ ...äººç±»å¿ƒä¸­æœ€æ·±çš„<mark>æœªçŸ¥</mark>...              â”‚  â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚ â”‚ ç¬¬23ç«                                             â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ ...é¢å¯¹<mark>æœªçŸ¥</mark>çš„å‘½è¿...                  â”‚  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶è§„èŒƒ

#### æœç´¢è¾“å…¥æ¡†

```typescript
interface SearchInputProps {
  value: string;
  onChange: (value: string) => void;
  placeholder?: string;
  debounce?: number;        // é˜²æŠ–å»¶è¿Ÿï¼ˆmsï¼‰ï¼Œé»˜è®¤ 300
  autoFocus?: boolean;      // è‡ªåŠ¨èšç„¦
}
```

**è¡Œä¸ºè§„èŒƒ**ï¼š
- è¾“å…¥æ—¶é˜²æŠ– 300ms åæ‰§è¡Œæœç´¢
- æœ€å°æœç´¢é•¿åº¦ï¼š1 ä¸ªä¸­æ–‡å­—ç¬¦æˆ– 2 ä¸ªè‹±æ–‡å­—ç¬¦
- è¾“å…¥ä¸ºç©ºæ—¶æ˜¾ç¤ºæœç´¢å†å²

#### ç­›é€‰åŒº

**ç»„ä»¶**ï¼š
- ç« èŠ‚èŒƒå›´é€‰æ‹©å™¨ï¼šä¸‹æ‹‰èœå• / å¤šé€‰æ¡†
- åŒ¹é…æ¨¡å¼é€‰æ‹©å™¨ï¼šç²¾ç¡® / æ¨¡ç³Š / æ­£åˆ™
- æ›´å¤šé€‰é¡¹æŒ‰é’®ï¼šå±•å¼€é«˜çº§ç­›é€‰

#### ç»“æœç»Ÿè®¡

```
æ‰¾åˆ° {count} ä¸ªåŒ¹é…é¡¹ (å…± {chapterCount} ç« )
å½“å‰ï¼šç¬¬ {current} / {total} ä¸ª
```

#### å¯¼èˆªæ§åˆ¶

```
[â—€ ä¸Šä¸€ä¸ª] [ä¸‹ä¸€ä¸ª â–¼]
```

**å¿«æ·é”®ç»‘å®š**ï¼š
- Enter / F3ï¼šä¸‹ä¸€ä¸ª
- Shift + Enter / Shift + F3ï¼šä¸Šä¸€ä¸ª

---

## æœç´¢ç»“æœå±•ç¤º

### ç»“æœåˆ—è¡¨ç»„ä»¶

#### æŒ‰ç« èŠ‚åˆ†ç»„

```typescript
interface SearchResultGroup {
  chapterId: string;
  chapterTitle: string;
  chapterIndex: number;
  matchCount: number;
  results: SearchResultItem[];
}

interface SearchResultItem {
  spanId: string;
  text: string;              // åŒ¹é…ç‰‡æ®µ
  prefix: string;            // å‰ç½®ä¸Šä¸‹æ–‡
  suffix: string;            // åç½®ä¸Šä¸‹æ–‡
  matchStart: number;        // åŒ¹é…èµ·å§‹ä½ç½®
  matchLength: number;       // åŒ¹é…é•¿åº¦
}
```

#### ä¸Šä¸‹æ–‡å±•ç¤ºè§„åˆ™

| åœºæ™¯ | å‰ç½®å­—ç¬¦æ•° | åç½®å­—ç¬¦æ•° |
|------|------------|------------|
| é»˜è®¤ | 30 | 30 |
| ä¸­æ–‡å†…å®¹ | 20 | 20 |
| åŒ¹é…é¡¹è¾ƒé•¿ | 15 | 15 |

**ç¤ºä¾‹**ï¼š
```
...æŠŠåœ°çƒé€’ç»™[æœªçŸ¥]æ–‡æ˜ã€‚å¥¹å¿½ç„¶æ„è¯†åˆ°...
              â†‘åŒ¹é…
```

### é«˜äº®æ˜¾ç¤º

#### é˜…è¯»å™¨å†…é«˜äº®

- **é¢œè‰²**ï¼šé»„è‰²èƒŒæ™¯ (#FFF59D) æˆ–ä¸»é¢˜è‰²
- **åŠ¨ç”»**ï¼šè½»å¾®è„‰å†²åŠ¨ç”»ï¼ˆé¦–æ¬¡åŠ è½½ï¼‰
- **å½“å‰åŒ¹é…**ï¼šä½¿ç”¨æ›´æ˜æ˜¾çš„é¢œè‰²æˆ–è¾¹æ¡†

#### ç»“æœåˆ—è¡¨é«˜äº®

```css
.mark {
  background-color: #FFF59D;
  border-radius: 2px;
  padding: 0 2px;
}

.mark.current {
  background-color: #FFEB3B;
  box-shadow: 0 0 4px rgba(255, 235, 59, 0.5);
}
```

### ç»“æœäº¤äº’

#### ç‚¹å‡»ç»“æœ

1. å¯¼èˆªåˆ°å¯¹åº”ç« èŠ‚
2. æ»šåŠ¨åˆ°åŒ¹é…æ®µè½
3. é«˜äº®å½“å‰åŒ¹é…é¡¹
4. æ›´æ–°å¯¼èˆªè®¡æ•°

#### é”®ç›˜å¯¼èˆª

| æŒ‰é”® | è¡Œä¸º |
|------|------|
| â†‘ / â†“ | åœ¨ç»“æœåˆ—è¡¨ä¸­ä¸Šä¸‹ç§»åŠ¨ |
| Enter | è·³è½¬åˆ°å½“å‰é€‰ä¸­ç»“æœ |
| Esc | å…³é—­æœç´¢é¢æ¿ |
| Tab | åœ¨æœç´¢æ¡†å’Œç»“æœåˆ—è¡¨é—´åˆ‡æ¢ |

---

## é«˜çº§æœç´¢åŠŸèƒ½

### æœç´¢èŒƒå›´

```
èŒƒå›´é€‰æ‹©ï¼š
â—‹ å½“å‰ç« èŠ‚
â—‹ å…¨ä¹¦
â—‹ æŒ‡å®šç« èŠ‚èŒƒå›´ [ç¬¬ ___ ç«  åˆ° ç¬¬ ___ ç« ]
```

### åŒ¹é…æ¨¡å¼

```
åŒ¹é…æ¨¡å¼ï¼š
â—‹ ç²¾ç¡®åŒ¹é…  (å®Œå…¨ç›¸ç­‰)
â—‹ æ¨¡ç³ŠåŒ¹é…  (åŒ…å«å…³é”®è¯ï¼Œé»˜è®¤)
â—‹ æ­£åˆ™è¡¨è¾¾å¼  (æ”¯æŒæ­£åˆ™è¯­æ³•)
```

**æ­£åˆ™ç¤ºä¾‹**ï¼š
- `å¶.*æ´`ï¼šåŒ¹é…"å¶æ–‡æ´"ã€"å¶æŸæ´"ç­‰
- `çº¢å²¸|ä¸‰ä½“`ï¼šåŒ¹é…"çº¢å²¸"æˆ–"ä¸‰ä½“"
- `^ç¬¬.*ç« `ï¼šåŒ¹é…ä»¥"ç¬¬"å¼€å¤´ã€"ç« "ç»“å°¾çš„æ ‡é¢˜

### é«˜çº§é€‰é¡¹é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é«˜çº§æœç´¢é€‰é¡¹                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¡ åŒºåˆ†å¤§å°å†™                                 â”‚
â”‚ â–¡ å…¨å­—åŒ¹é…                                   â”‚
â”‚ â–¡ åŒ…å«ä¹¦ç­¾å’Œç¬”è®°å†…å®¹                         â”‚
â”‚ â–¡ ä»…åœ¨ä¸»è¦ç« èŠ‚æœç´¢ï¼ˆæ’é™¤åºç« /åè®°ï¼‰          â”‚
â”‚                                             â”‚
â”‚ ä¸Šä¸‹æ–‡é•¿åº¦ï¼š[â”â”â”â”â—â”â”â”] 50 å­—ç¬¦               â”‚
â”‚                                             â”‚
â”‚ æœç´¢å†å²ï¼š                                   â”‚
â”‚   â€¢ å¶æ–‡æ´                   [Ã—]            â”‚
â”‚   â€¢ çº¢å²¸åŸºåœ°                 [Ã—]            â”‚
â”‚   â€¢ ä¸‰ä½“æ¸¸æˆ                 [Ã—]            â”‚
â”‚   [æ¸…é™¤å…¨éƒ¨å†å²]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº¤äº’æµç¨‹

### æœç´¢æµç¨‹å›¾

```mermaid
flowchart TD
    Start([ç”¨æˆ·æ‰“å¼€æœç´¢]) --> Input[è¾“å…¥å…³é”®è¯]
    Input --> Debounce{é˜²æŠ– 300ms}
    Debounce --> Validate{éªŒè¯è¾“å…¥}
    Validate -->|æ— æ•ˆ| ShowError[æ˜¾ç¤ºé”™è¯¯æç¤º]
    Validate -->|æœ‰æ•ˆ| Search[æ‰§è¡Œæœç´¢]

    Search --> HasResults{æœ‰ç»“æœ?}
    HasResults -->|æ— | ShowNone[æ˜¾ç¤º"æ— åŒ¹é…"]
    HasResults -->|æœ‰| ShowResults[æ˜¾ç¤ºç»“æœåˆ—è¡¨]

    ShowResults --> UserAction{ç”¨æˆ·æ“ä½œ}
    UserAction -->|ç‚¹å‡»ç»“æœ| Navigate[å¯¼èˆªå¹¶é«˜äº®]
    UserAction -->|ä¸‹ä¸€/ä¸Šä¸€| NavigatePrevNext[åˆ‡æ¢åŒ¹é…]
    UserAction -->|ç»§ç»­è¾“å…¥| Input
    UserAction -->|å…³é—­é¢æ¿| Close[å…³é—­æœç´¢]

    Navigate --> UpdateCount[æ›´æ–°è®¡æ•°]
    NavigatePrevNext --> UpdateCount
    UpdateCount --> ShowResults

    Close --> End([ç»“æŸ])
    ShowNone --> Input
    ShowError --> Input

    style Start fill:#e1f5fe
    style End fill:#e1f5fe
    style Search fill:#fff3e0
    style ShowResults fill:#c8e6c9
    style Navigate fill:#c8e6c9
```

### çŠ¶æ€æœº

```mermaid
stateDiagram-v2
    [*] --> Closed
    Closed --> Opening: æ‰“å¼€æœç´¢é¢æ¿
    Opening --> Idle: é¢æ¿å±•å¼€å®Œæˆ
    Idle --> Searching: è¾“å…¥å…³é”®è¯
    Searching --> Idle: æœç´¢å®Œæˆ/æ¸…ç©º
    Searching --> NoResults: æ— åŒ¹é…ç»“æœ
    Searching -> HasResults: æœ‰åŒ¹é…ç»“æœ
    Idle --> Closed: å…³é—­é¢æ¿/Esc
    NoResults --> Idle: ä¿®æ”¹è¾“å…¥
    HasResults --> Idle: æ¸…ç©ºè¾“å…¥
    HasResults --> Navigating: é€‰æ‹©ç»“æœ
    Navigating --> HasResults: å®šä½å®Œæˆ
    HasResults --> Closed: å…³é—­é¢æ¿
    NoResults --> Closed: å…³é—­é¢æ¿
```

---

## æŠ€æœ¯å®ç°

### æœç´¢ç®—æ³•

#### FTS5 å…¨æ–‡æœç´¢

åˆ©ç”¨ SQLite çš„ FTS5 å…¨æ–‡æœç´¢åŠŸèƒ½ï¼š

```sql
-- åˆ›å»º FTS5 è™šæ‹Ÿè¡¨
CREATE VIRTUAL TABLE chapters_fts USING fts5(
  content,
  content='chapters',
  content_rowid='rowid',
  tokenize='unicode61'  -- æ”¯æŒä¸­æ–‡åˆ†è¯
);

-- æœç´¢æŸ¥è¯¢
SELECT
  c.id,
  c.chapter_index,
  c.title,
  snippet(chapters_fts, 0, '<mark>', '</mark>', '...', 30) as snippet
FROM chapters c
JOIN chapters_fts f ON c.id = f.rowid
WHERE chapters_fts MATCH ? AND c.book_id = ?
ORDER BY rank;
```

#### å‰ç«¯æœç´¢

å¯¹äºå°å†…å®¹é‡ï¼Œå¯ä½¿ç”¨å‰ç«¯æœç´¢ï¼š

```typescript
// ç®€å•çš„å­—ç¬¦ä¸²æœç´¢
function searchText(content: string, query: string): SearchResult[] {
  const results: SearchResult[] = [];
  const regex = new RegExp(query, 'gi');
  let match;
  let index = 0;

  while ((match = regex.exec(content)) !== null) {
    results.push({
      index: match.index,
      text: match[0],
      prefix: content.substring(Math.max(0, match.index - 30), match.index),
      suffix: content.substring(match.index + match[0].length,
                              Math.min(content.length, match.index + match[0].length + 30))
    });
  }

  return results;
}

// ä¸­æ–‡åˆ†è¯ï¼ˆä½¿ç”¨ Intl.Segmenterï¼‰
function segmentChinese(text: string): string[] {
  const segmenter = new Intl.Segmenter('zh-CN', { granularity: 'word' });
  return [...segmenter.segment(text)]
    .filter(s => s.isWordLike)
    .map(s => s.segment);
}
```

### æ€§èƒ½ä¼˜åŒ–

1. **é˜²æŠ–**ï¼šè¾“å…¥é˜²æŠ– 300ms
2. **åˆ†é¡µ**ï¼šç»“æœåˆ—è¡¨åˆ†é¡µåŠ è½½ï¼ˆæ¯é¡µ 20 æ¡ï¼‰
3. **è™šæ‹Ÿæ»šåŠ¨**ï¼šå¤§é‡ç»“æœä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
4. **ç¼“å­˜**ï¼šæœç´¢ç»“æœç¼“å­˜ï¼ˆæŒ‰æŸ¥è¯¢é”®ï¼‰
5. **Web Worker**ï¼šæœç´¢é€»è¾‘æ”¾åˆ° Worker çº¿ç¨‹

### æœç´¢æœåŠ¡æ¥å£

```typescript
interface SearchService {
  /**
   * æœç´¢ä¹¦ç±å†…å®¹
   */
  search(params: SearchParams): Promise<SearchResults>;

  /**
   * è·å–æœç´¢å»ºè®®
   */
  suggest(query: string, bookId: string): Promise<string[]>;

  /**
   * ä¿å­˜æœç´¢å†å²
   */
  saveHistory(query: string, bookId: string): void;

  /**
   * è·å–æœç´¢å†å²
   */
  getHistory(bookId: string): SearchHistoryItem[];

  /**
   * æ¸…é™¤æœç´¢å†å²
   */
  clearHistory(bookId: string): void;
}
```

---

## TypeScript ç±»å‹å®šä¹‰

```typescript
// =====================
// æœç´¢å‚æ•°ç±»å‹
// =====================

/**
 * æœç´¢èŒƒå›´
 */
enum SearchScope {
  CURRENT_CHAPTER = 'current_chapter',
  ALL_CHAPTERS = 'all_chapters',
  CHAPTER_RANGE = 'chapter_range',
}

/**
 * åŒ¹é…æ¨¡å¼
 */
enum MatchMode {
  EXACT = 'exact',
  FUZZY = 'fuzzy',
  REGEX = 'regex',
}

/**
 * æœç´¢å‚æ•°
 */
interface SearchParams {
  bookId: string;
  query: string;
  scope: SearchScope;
  chapterRange?: [number, number]; // ç« èŠ‚èŒƒå›´ [start, end]
  matchMode: MatchMode;
  caseSensitive?: boolean;
  wholeWord?: boolean;
  includeNotes?: boolean;
  contextLength?: number; // ä¸Šä¸‹æ–‡å­—ç¬¦æ•°
}

// =====================
// æœç´¢ç»“æœç±»å‹
// =====================

/**
 * æœç´¢ç»“æœé¡¹
 */
interface SearchResultItem {
  spanId: string;
  chapterId: string;
  chapterIndex: number;
  chapterTitle: string;
  matchText: string;
  prefix: string;
  suffix: string;
  matchStart: number;
  matchEnd: number;
}

/**
 * æœç´¢ç»“æœåˆ†ç»„
 */
interface SearchResultGroup {
  chapterId: string;
  chapterIndex: number;
  chapterTitle: string;
  matchCount: number;
  items: SearchResultItem[];
}

/**
 * æœç´¢ç»“æœ
 */
interface SearchResults {
  query: string;
  totalMatches: number;
  totalChapters: number;
  groups: SearchResultGroup[];
  hasMore: boolean;
  searchTime: number; // æ¯«ç§’
}

// =====================
// æœç´¢å†å²ç±»å‹
// =====================

/**
 * æœç´¢å†å²é¡¹
 */
interface SearchHistoryItem {
  id: string;
  query: string;
  bookId: string;
  timestamp: number;
  resultCount: number;
}

// =====================
// æœç´¢çŠ¶æ€ç±»å‹
// =====================

/**
 * æœç´¢çŠ¶æ€
 */
enum SearchState {
  IDLE = 'idle',
  SEARCHING = 'searching',
  HAS_RESULTS = 'has_results',
  NO_RESULTS = 'no_results',
  ERROR = 'error',
}

/**
 * æœç´¢ä¸Šä¸‹æ–‡
 */
interface SearchContext {
  state: SearchState;
  query: string;
  results: SearchResults | null;
  currentIndex: number;
  error?: string;
}

// =====================
// UI ç»„ä»¶ç±»å‹
// =====================

/**
 * æœç´¢é¢æ¿çŠ¶æ€
 */
interface SearchPanelState {
  isOpen: boolean;
  query: string;
  params: SearchParams;
  results: SearchResults | null;
  currentIndex: number;
  showAdvanced: boolean;
}

/**
 * æœç´¢é€‰é¡¹é…ç½®
 */
interface SearchOptions {
  debounceMs?: number;
  minQueryLength?: number;
  maxHistoryItems?: number;
  defaultContextLength?: number;
  highlightColor?: string;
  currentHighlightColor?: string;
}
```

---

## å®æ–½æŒ‡å—

### é˜¶æ®µ1ï¼šåŸºç¡€æœç´¢ï¼ˆP0ï¼‰

1. **æœç´¢å…¥å£**
   - å·¥å…·æ æœç´¢æŒ‰é’®
   - å¿«æ·é”®æ”¯æŒ
   - æœç´¢é¢æ¿ç»„ä»¶

2. **åŸºç¡€æœç´¢åŠŸèƒ½**
   - ç®€å•å­—ç¬¦ä¸²åŒ¹é…
   - ç»“æœåˆ—è¡¨å±•ç¤º
   - æ®µè½é«˜äº®

3. **ç»“æœå¯¼èˆª**
   - ä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ª
   - ç‚¹å‡»ç»“æœè·³è½¬
   - åŒ¹é…è®¡æ•°

### é˜¶æ®µ2ï¼šå¢å¼ºåŠŸèƒ½ï¼ˆP1ï¼‰

1. **é«˜çº§ç­›é€‰**
   - ç« èŠ‚èŒƒå›´é€‰æ‹©
   - åŒ¹é…æ¨¡å¼åˆ‡æ¢
   - é€‰é¡¹é¢æ¿

2. **æœç´¢å†å²**
   - å†å²è®°å½•ä¿å­˜
   - å†å²è®°å½•ç®¡ç†
   - å¿«é€Ÿé‡æœ

3. **æ€§èƒ½ä¼˜åŒ–**
   - FTS5 é›†æˆ
   - ç»“æœç¼“å­˜
   - è™šæ‹Ÿæ»šåŠ¨

### é˜¶æ®µ3ï¼šé«˜çº§åŠŸèƒ½ï¼ˆP2ï¼‰

1. **æ™ºèƒ½æœç´¢**
   - æœç´¢å»ºè®®
   - è‡ªåŠ¨çº é”™
   - åŒä¹‰è¯æ‰©å±•

2. **å¤šè¯­è¨€æ”¯æŒ**
   - è‹±æ–‡æœç´¢ä¼˜åŒ–
   - æ··åˆå†…å®¹æœç´¢

3. **å¯¼å‡ºåŠŸèƒ½**
   - å¯¼å‡ºæœç´¢ç»“æœ
   - ç”ŸæˆæŠ¥å‘Š

### éªŒæ”¶æ ‡å‡†

- [ ] æœç´¢å…¥å£å¯ç”¨ï¼Œæ”¯æŒå¿«æ·é”®
- [ ] æœç´¢å“åº”æ—¶é—´ < 500msï¼ˆå…¨ä¹¦ï¼‰
- [ ] ç»“æœå±•ç¤ºå‡†ç¡®ï¼Œä¸Šä¸‹æ–‡å®Œæ•´
- [ ] é«˜äº®å®šä½æ­£ç¡®ç‡ 100%
- [ ] æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æœç´¢
- [ ] æœç´¢å†å²æ­£å¸¸ä¿å­˜å’Œæ¢å¤
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

---

## é™„å½•

### å¿«æ·é”®é€ŸæŸ¥è¡¨

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| Ctrl+F / Cmd+F | æ‰“å¼€æœç´¢ |
| Ctrl+G / F3 | ä¸‹ä¸€ä¸ªåŒ¹é… |
| Ctrl+Shift+G / Shift+F3 | ä¸Šä¸€ä¸ªåŒ¹é… |
| Escape | å…³é—­æœç´¢ |
| Ctrl+A | å…¨é€‰è¾“å…¥æ¡† |
| Ctrl+C | å¤åˆ¶å½“å‰ç»“æœ |

### å‚è€ƒæ–‡æ¡£

- [SQLite FTS5 æ–‡æ¡£](https://www.sqlite.org/fts5.html)
- [Intl.Segmenter API](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/Segmenter)
- é¡¹ç›®å¼€å‘è®¡åˆ’: `.omc/plans/ai-reader-development-plan.md`

### å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|----------|------|
| 1.0 | 2026-02-19 | åˆå§‹ç‰ˆæœ¬ | designer-3 |

---

*æ–‡æ¡£ç»“æŸ*
