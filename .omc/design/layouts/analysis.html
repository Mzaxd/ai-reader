<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Reader - Analysis Workspace (Plan Aligned)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../tokens.css">
  <style>
    body { margin: 0; min-height: 100vh; }
    .shell { max-width: 1180px; margin: 0 auto; padding: 12px; display: grid; gap: 10px; }
    .top { border: var(--md-border-strong); border-radius: 10px; background: var(--md-surface-1); padding: 10px 12px; display: flex; justify-content: space-between; align-items: center; gap: 8px; flex-wrap: wrap; }
    .top h1 { margin: 0; font-size: 22px; }
    .tabs { border: var(--md-border-strong); border-radius: 10px; background: var(--md-surface-1); padding: 8px; display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 8px; }
    .tab { border: var(--md-border-strong); border-radius: 8px; background: var(--md-surface-1); padding: 8px; text-align: center; font-family: var(--font-ui); font-size: 12px; text-transform: uppercase; cursor: pointer; }
    .tab.active { background: var(--md-sun); }
    .view { border: var(--md-border-strong); border-radius: 10px; background: var(--md-surface-1); overflow: hidden; display: none; }
    .view.active { display: block; }
    .head { border-bottom: var(--md-border-strong); padding: 8px 10px; font-family: var(--font-ui); font-size: 12px; text-transform: uppercase; }
    .body { padding: 10px; display: grid; gap: 8px; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .item { border: var(--md-border-soft-line); border-radius: 8px; background: var(--md-surface-1); padding: 8px; display: grid; gap: 6px; font-size: 13px; }
    .item strong { font-size: 14px; }
    .k { font-family: var(--font-ui); font-size: 11px; text-transform: uppercase; color: var(--md-ink-soft); }
    .graph { border: var(--md-border-strong); border-radius: 8px; min-height: 230px; position: relative; background: var(--md-surface-1); overflow: hidden; }
    .graph::before,.graph::after { content: ""; position: absolute; left: 0; right: 0; border-top: 1px dashed var(--md-border-mid); }
    .graph::before { top: 33%; } .graph::after { top: 66%; }
    .node { position: absolute; border: var(--md-border-strong); border-radius: 999px; background: var(--md-surface-1); padding: 4px 10px; font-family: var(--font-ui); font-size: 11px; text-transform: uppercase; }
    .n0 { left: 44%; top: 40%; background: color-mix(in srgb, var(--md-sun) 60%, var(--md-surface-1)); }
    .n1 { left: 10%; top: 16%; background: color-mix(in srgb, var(--md-sky) 30%, var(--md-surface-1)); }
    .n2 { right: 10%; top: 17%; background: color-mix(in srgb, var(--md-danger) 20%, var(--md-surface-1)); }
    .n3 { left: 16%; bottom: 15%; background: var(--md-surface-3); }
    .n4 { right: 16%; bottom: 15%; background: color-mix(in srgb, var(--md-sun) 30%, var(--md-surface-1)); }
    .timeline-item,.event-item { border: var(--md-border-strong); border-radius: 8px; background: var(--md-surface-1); padding: 8px; font-size: 14px; }
    .timeline-item .k,.event-item .k { margin-bottom: 4px; display: inline-block; }
    .danger { border: var(--md-border-strong); border-radius: 8px; background: color-mix(in srgb, var(--md-danger) 18%, var(--md-surface-1)); padding: 8px; font-size: 13px; }
    @media (max-width: 860px) { .grid2 { grid-template-columns: 1fr; } .tabs { grid-template-columns: 1fr; } }
  </style>
</head>
<body class="md-noise">
  <div class="shell">
    <header class="top">
      <h1>分析工作台（人物 / 时间线 / 事件）</h1>
      <div class="row">
        <button class="md-btn" id="themeBtn">Theme</button>
        <button class="md-btn md-btn-primary">重新分析当前章节</button>
      </div>
    </header>

    <div class="tabs" id="tabs">
      <button class="tab active" data-tab="characters">人物关系</button>
      <button class="tab" data-tab="timeline">时间线</button>
      <button class="tab" data-tab="events">事件分析</button>
    </div>

    <section class="view active" data-view="characters">
      <div class="head">Step 4 人物关系分析</div>
      <div class="body">
        <div class="grid2">
          <article class="item">
            <strong>人物列表与筛选</strong>
            <input class="md-input" placeholder="搜索人物 / 别名">
            <div>罗辑（别名：面壁者）· 出场 42 次</div>
            <div>史强（别名：大史）· 出场 38 次</div>
            <div>丁仪 · 出场 25 次</div>
            <div class="row">
              <button class="md-btn">Add Character</button>
              <button class="md-btn">Edit Alias</button>
            </div>
          </article>
          <article class="item">
            <strong>关系图谱（可编辑）</strong>
            <div class="graph">
              <span class="node n0">罗辑</span><span class="node n1">史强</span><span class="node n2">丁仪</span><span class="node n3">章北海</span><span class="node n4">ETO</span>
            </div>
            <div class="timeline-item"><span class="k">关系时间节点</span><br>T+00:00 罗辑-史强协作增强；T+00:05 丁仪-ETO 对立增强。</div>
            <div class="row">
              <button class="md-btn">Edit Relation Type</button>
              <button class="md-btn">Adjust Strength</button>
              <button class="md-btn">Export JSON</button>
            </div>
          </article>
        </div>
        <div class="danger">离线降级：仅允许手动编辑与查看缓存结果（计划要求）。</div>
      </div>
    </section>

    <section class="view" data-view="timeline">
      <div class="head">Step 5 时间线分析</div>
      <div class="body">
        <div class="grid2">
          <article class="item">
            <strong>筛选与排序</strong>
            <select class="md-select"><option>故事时间顺序</option><option>章节顺序</option></select>
            <select class="md-select"><option>垂直时间线</option><option>水平时间线</option></select>
            <label class="k">缩放</label>
            <input type="range" min="1" max="4" step="1" value="2">
            <input class="md-input" placeholder="时间范围筛选，例如 T-00:30 ~ T+02:00">
            <input class="md-input" placeholder="人物筛选，例如 罗辑">
            <input class="md-input" placeholder="事件搜索关键词">
          </article>
          <article class="item">
            <strong>时间线视图</strong>
            <div class="timeline-item"><span class="k">T-00:30</span><br>参数复核完成，阵列预热。</div>
            <div class="timeline-item"><span class="k">T+00:00</span><br>指令下达，舰体回波异常。</div>
            <div class="timeline-item"><span class="k">T+00:05</span><br>会议回放验证，可复现确认。</div>
            <div class="row"><button class="md-btn">Add Event</button><button class="md-btn">Edit Event</button><button class="md-btn">Jump to Source</button></div>
          </article>
        </div>
      </div>
    </section>

    <section class="view" data-view="events">
      <div class="head">Step 6 事件分析</div>
      <div class="body">
        <div class="grid2">
          <article class="item">
            <strong>事件列表与重要性</strong>
            <div class="event-item"><span class="k">HIGH</span><br>古筝行动成功（关键转折）。</div>
            <div class="event-item"><span class="k">MEDIUM</span><br>ETO 供述口径变化。</div>
            <div class="event-item"><span class="k">LOW</span><br>会后讨论记录整理。</div>
            <div class="row"><button class="md-btn">Sort by Importance</button><button class="md-btn">Export Analysis</button></div>
          </article>
          <article class="item">
            <strong>因果链与阅读联动</strong>
            <div class="event-item"><span class="k">Cause</span><br>纳米丝行动展示工程化优势。</div>
            <div class="event-item"><span class="k">Effect</span><br>叙事由绝对悲观转向局部可对抗。</div>
            <div class="event-item"><span class="k">Follow-up</span><br>后续章节强化威慑逻辑。</div>
            <div class="row"><button class="md-btn">Open Causal Chain</button><button class="md-btn">Jump to Reader</button></div>
          </article>
        </div>
      </div>
    </section>
  </div>

  <script>
    const root = document.documentElement;
    document.getElementById('themeBtn').addEventListener('click', () => {
      const isDark = root.getAttribute('data-theme') === 'dark';
      root.setAttribute('data-theme', isDark ? 'light' : 'dark');
    });

    const tabs = document.querySelectorAll('.tab');
    const views = document.querySelectorAll('.view');
    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        tabs.forEach((t) => t.classList.toggle('active', t === tab));
        views.forEach((v) => v.classList.toggle('active', v.dataset.view === tab.dataset.tab));
      });
    });
  </script>
</body>
</html>
