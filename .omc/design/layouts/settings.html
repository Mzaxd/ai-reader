<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Reader - Settings Prototype (Plan Aligned)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../tokens.css">
  <style>
    body { margin: 0; min-height: 100vh; }
    .shell { max-width: 1120px; margin: 0 auto; padding: 14px; display: grid; gap: 10px; }
    .header { border: var(--md-border-strong); border-radius: 10px; background: var(--md-surface-1); padding: 10px 12px; display: flex; justify-content: space-between; gap: 8px; align-items: center; flex-wrap: wrap; }
    .header h1 { margin: 0; font-size: 22px; }
    .layout { display: grid; grid-template-columns: 250px 1fr; gap: 10px; min-height: 0; }
    .nav, .panel { border: var(--md-border-strong); border-radius: 10px; background: var(--md-surface-1); overflow: hidden; }
    .nav { padding: 9px; display: grid; gap: 6px; align-content: start; }
    .nav button { border: var(--md-border-soft-line); border-radius: 8px; background: var(--md-surface-1); padding: 8px; text-align: left; cursor: pointer; }
    .nav button.active { border: var(--md-border-strong); background: color-mix(in srgb, var(--md-sky) 24%, var(--md-surface-1)); }
    .panel .head { border-bottom: var(--md-border-strong); padding: 8px 10px; font-family: var(--font-ui); font-size: 12px; text-transform: uppercase; }
    .panel .body { padding: 10px; display: grid; gap: 8px; }
    .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .grid2 { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 8px; }
    .item { border: var(--md-border-soft-line); border-radius: 8px; background: var(--md-surface-1); padding: 8px; display: grid; gap: 6px; }
    .item strong { font-size: 14px; }
    .warn { border: var(--md-border-strong); border-radius: 8px; background: color-mix(in srgb, var(--md-warning) 22%, var(--md-surface-1)); padding: 8px; font-size: 13px; }
    .danger { border: var(--md-border-strong); border-radius: 8px; background: color-mix(in srgb, var(--md-danger) 20%, var(--md-surface-1)); padding: 8px; font-size: 13px; }
    @media (max-width: 860px) { .layout { grid-template-columns: 1fr; } .grid2 { grid-template-columns: 1fr; } }
  </style>
</head>
<body class="md-noise">
  <div class="shell">
    <header class="header">
      <h1>AI Settings（计划对齐）</h1>
      <div class="row">
        <button class="md-btn" id="themeBtn">Theme</button>
        <button class="md-btn md-btn-primary">保存配置</button>
      </div>
    </header>

    <div class="layout">
      <aside class="nav">
        <button class="active">Provider 与模型</button>
        <button>预算与成本控制</button>
        <button>离线模式与队列</button>
        <button>安全存储与密钥</button>
        <button>阅读偏好</button>
      </aside>

      <main class="panel">
        <div class="head">Provider 与模型（Step 3）</div>
        <div class="body">
          <div class="grid2">
            <section class="item">
              <strong>OpenAI</strong>
              <label>API Key</label>
              <input class="md-input" type="password" value="sk-********************************">
              <label>模型</label>
              <select class="md-select"><option>gpt-4.1-mini</option><option>gpt-4.1</option></select>
              <div class="row"><span class="md-chip">safeStorage</span><span class="md-chip">Encrypted</span></div>
            </section>
            <section class="item">
              <strong>Claude</strong>
              <label>API Key</label>
              <input class="md-input" type="password" value="sk-ant-******************************">
              <label>模型</label>
              <select class="md-select"><option>claude-3-7-sonnet</option><option>claude-3-5-sonnet</option></select>
              <div class="row"><span class="md-chip">safeStorage</span><span class="md-chip">Encrypted</span></div>
            </section>
            <section class="item">
              <strong>Ollama（P1）</strong>
              <label>Endpoint</label>
              <input class="md-input" value="http://127.0.0.1:11434">
              <label>模型</label>
              <select class="md-select"><option>qwen2.5:14b</option><option>llama3.3:70b</option></select>
              <div class="row"><span class="md-chip">Offline AI</span><span class="md-chip">Warming</span></div>
            </section>
            <section class="item">
              <strong>参数</strong>
              <label>Temperature</label>
              <input type="range" min="0" max="1" step="0.05" value="0.3">
              <label>max_tokens</label>
              <input class="md-input" value="4096">
              <label>上下文窗口</label>
              <input class="md-input" value="8k">
              <label>检索策略</label>
              <select class="md-select"><option>Hybrid（向量 + 全文）</option><option>Vector Only</option><option>Fulltext Only</option></select>
            </section>
          </div>

          <div class="head" style="margin:2px -10px 0;">预算与成本控制（Step 3）</div>
          <div class="grid2">
            <section class="item">
              <strong>预算</strong>
              <label>日限额</label><input class="md-input" value="$5.00">
              <label>月限额</label><input class="md-input" value="$120.00">
              <label>单次限额（高成本确认阈值）</label><input class="md-input" value="$0.25">
            </section>
            <section class="item">
              <strong>使用量</strong>
              <div>今日 Token: 182k</div>
              <div>今日费用: $3.15 (63%)</div>
              <div>月累计: $52.40</div>
              <div class="warn">即将接近日预算上限，建议优先使用本地模型处理摘要任务。</div>
            </section>
          </div>

          <div class="head" style="margin:2px -10px 0;">离线模式与任务队列（Step 3/Step 8）</div>
          <div class="grid2">
            <section class="item">
              <strong>网络状态</strong>
              <div><i class="md-status-dot md-status-warn"></i>当前离线，已启用降级模式。</div>
              <div>检测方式: Node.js DNS 查询（计划共识修订项）。</div>
              <div>降级策略: 基础阅读 + 本地缓存分析 + Ollama（若可用）</div>
            </section>
            <section class="item">
              <strong>离线队列</strong>
              <div>人物分析 · 三体（等待提交）</div>
              <div>时间线分析 · 红楼梦（等待提交）</div>
              <button class="md-btn">手动重试提交</button>
            </section>
          </div>

          <div class="head" style="margin:2px -10px 0;">安全与验收提示</div>
          <div class="danger">计划要求：不得硬编码密钥；仅使用 safeStorage。发布前需做密钥泄漏扫描。</div>
        </div>
      </main>
    </div>
  </div>

  <script>
    const root = document.documentElement;
    document.getElementById('themeBtn').addEventListener('click', () => {
      const isDark = root.getAttribute('data-theme') === 'dark';
      root.setAttribute('data-theme', isDark ? 'light' : 'dark');
    });
  </script>
</body>
</html>
